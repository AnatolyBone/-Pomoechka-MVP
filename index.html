<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ü–æ–º–æ–µ—á–∫–∞ –∫–æ—Ä–º–∏—Ç üóëÔ∏è‚ú®</title>
    
    <!-- Telegram WebApp SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
    
    <!-- App Styles -->
    <link rel="stylesheet" href="css/styles.css">
    
    <!-- Eruda –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ (—É–¥–∞–ª–∏—Ç—å –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ) -->
    <script src="https://cdn.jsdelivr.net/npm/eruda"></script>
    <script>eruda.init();</script>
    
    <style>
        * { font-family: 'Nunito', sans-serif; }
        .screen { display: none; }
        .screen.active { display: flex; flex-direction: column; }
    </style>
</head>
<body class="min-h-screen bg-gray-50">

    <!-- Auth Screen -->
    <div id="authScreen" class="min-h-screen flex items-center justify-center p-4 bg-gradient-to-br from-emerald-100 via-teal-50 to-cyan-100">
        <div class="bg-white rounded-2xl shadow-lg p-8 max-w-md w-full text-center">
            <div class="text-6xl mb-4">üóëÔ∏è</div>
            <h1 class="text-2xl font-bold text-gray-800 mb-2">–ü–æ–º–æ–µ—á–∫–∞ –∫–æ—Ä–º–∏—Ç</h1>
            <p class="text-gray-500 mb-6">Telegram –º–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –æ–±–º–µ–Ω–∞ –Ω–∞—Ö–æ–¥–∫–∞–º–∏</p>
            
            <div id="authStatus" class="mb-6">
                <div class="animate-pulse flex items-center justify-center gap-2 text-gray-500">
                    <div class="w-4 h-4 border-2 border-gray-400 border-t-transparent rounded-full animate-spin"></div>
                    –ó–∞–≥—Ä—É–∑–∫–∞...
                </div>
            </div>
            
            <div id="authError" class="hidden bg-red-50 text-red-700 p-4 rounded-xl mb-4"></div>
        </div>
    </div>

    <!-- Main App -->
    <div id="mainApp" class="hidden min-h-screen">
        
        <!-- Screen: Map -->
        <div id="screen-map" class="screen h-screen bg-gray-50">
            <div class="bg-white px-4 py-3 border-b border-gray-100 z-10">
                <div class="flex items-center justify-between mb-2">
                    <div>
                        <h1 class="text-lg font-bold text-gray-800">üìç –ö–∞—Ä—Ç–∞ –Ω–∞—Ö–æ–¥–æ–∫</h1>
                        <p id="userLocation" class="text-xs text-gray-500">–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ...</p>
                    </div>
                    <div class="flex items-center gap-2">
                        <button id="adminBtnMap" class="hidden w-10 h-10 rounded-full bg-purple-500 items-center justify-center text-white shadow" onclick="openAdminPanel()">‚öôÔ∏è</button>
                        <button onclick="showScreen('profile')" id="profileBtnMap" class="w-10 h-10 rounded-full bg-gradient-to-br from-emerald-400 to-teal-500 flex items-center justify-center text-white font-bold shadow">?</button>
                    </div>
                </div>
                <div class="flex gap-2">
                    <button class="radius-btn px-3 py-1.5 bg-gray-100 rounded-full text-xs font-semibold" data-radius="0.5" onclick="setRadius(0.5)">500–º</button>
                    <button class="radius-btn active px-3 py-1.5 bg-emerald-500 text-white rounded-full text-xs font-semibold" data-radius="2" onclick="setRadius(2)">2–∫–º</button>
                    <button class="radius-btn px-3 py-1.5 bg-gray-100 rounded-full text-xs font-semibold" data-radius="5" onclick="setRadius(5)">5–∫–º</button>
                    <button class="radius-btn px-3 py-1.5 bg-gray-100 rounded-full text-xs font-semibold" data-radius="10" onclick="setRadius(10)">10–∫–º</button>
                </div>
            </div>
            
            <div class="flex-1 relative">
                <div id="mapContainer" class="absolute inset-0 bg-gradient-to-br from-green-50 via-blue-50 to-indigo-50">
                    <div class="absolute inset-0 opacity-20" style="background-image: linear-gradient(#ccc 1px, transparent 1px), linear-gradient(90deg, #ccc 1px, transparent 1px); background-size: 30px 30px;"></div>
                    <div id="mapMarkers"></div>
                    <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2">
                        <div class="w-4 h-4 bg-blue-500 rounded-full border-4 border-white shadow-lg"></div>
                        <div class="absolute inset-0 w-4 h-4 bg-blue-500 rounded-full animate-ping"></div>
                    </div>
                </div>
                
                <div id="mapPreview" class="absolute bottom-0 left-0 right-0 bg-white rounded-t-3xl shadow-2xl p-4 pb-20">
                    <div class="w-12 h-1 bg-gray-300 rounded-full mx-auto mb-3"></div>
                    <p id="mapItemsCount" class="text-xs text-gray-500 text-center">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
                </div>
            </div>
            
            <button onclick="showScreen('add')" class="floating-btn absolute bottom-36 right-4 w-14 h-14 bg-emerald-500 rounded-full flex items-center justify-center text-white text-2xl font-bold shadow-lg z-20">+</button>
            
            <div class="absolute bottom-0 left-0 right-0 bg-white border-t border-gray-100 px-6 py-3 flex justify-around z-20">
                <button class="nav-item flex flex-col items-center text-emerald-600" data-screen="map" onclick="showScreen('map')">
                    <span class="text-xl">üó∫Ô∏è</span>
                    <span class="text-xs font-semibold">–ö–∞—Ä—Ç–∞</span>
                </button>
                <button class="nav-item flex flex-col items-center text-gray-400" data-screen="feed" onclick="showScreen('feed')">
                    <span class="text-xl">üìã</span>
                    <span class="text-xs">–õ–µ–Ω—Ç–∞</span>
                </button>
                <button class="nav-item flex flex-col items-center text-gray-400" data-screen="add" onclick="showScreen('add')">
                    <span class="text-xl">‚ûï</span>
                    <span class="text-xs">–î–æ–±–∞–≤–∏—Ç—å</span>
                </button>
                <button class="nav-item flex flex-col items-center text-gray-400" data-screen="profile" onclick="showScreen('profile')">
                    <span class="text-xl">üë§</span>
                    <span class="text-xs">–ü—Ä–æ—Ñ–∏–ª—å</span>
                </button>
            </div>
        </div>

        <!-- Screen: Feed -->
        <div id="screen-feed" class="screen h-screen bg-gray-50">
            <div class="bg-white px-4 py-3 border-b border-gray-100">
                <div class="flex items-center justify-between mb-3">
                    <div>
                        <h1 class="text-xl font-bold text-gray-800">–ü–æ–º–æ–µ—á–∫–∞ üóëÔ∏è‚ú®</h1>
                        <p id="feedLocation" class="text-xs text-gray-500">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
                    </div>
                    <button onclick="showScreen('profile')" id="profileBtnFeed" class="w-10 h-10 rounded-full bg-gradient-to-br from-emerald-400 to-teal-500 flex items-center justify-center text-white font-bold shadow">?</button>
                </div>
                
                <div class="relative">
                    <input type="text" id="feedSearch" placeholder="–ü–æ–∏—Å–∫: –¥–∏–≤–∞–Ω, —Å—Ç—É–ª—å—è, –∫–Ω–∏–≥–∏..." 
                           class="w-full pl-10 pr-4 py-2.5 bg-gray-100 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500"
                           oninput="handleSearch(this.value)">
                    <span class="absolute left-3 top-2.5">üîç</span>
                </div>
                
                <div class="flex gap-2 mt-3 overflow-x-auto pb-1">
                    <button class="tab-btn active px-3 py-1.5 text-xs font-semibold border-b-2 border-emerald-500 text-emerald-600" data-category="all" onclick="setCategory('all')">üî• –í—Å–µ</button>
                    <button class="tab-btn px-3 py-1.5 text-xs font-semibold border-b-2 border-transparent text-gray-500" data-category="furniture" onclick="setCategory('furniture')">üõãÔ∏è –ú–µ–±–µ–ª—å</button>
                    <button class="tab-btn px-3 py-1.5 text-xs font-semibold border-b-2 border-transparent text-gray-500" data-category="construction" onclick="setCategory('construction')">üß± –°—Ç—Ä–æ–π</button>
                    <button class="tab-btn px-3 py-1.5 text-xs font-semibold border-b-2 border-transparent text-gray-500" data-category="electronics" onclick="setCategory('electronics')">üì∫ –¢–µ—Ö–Ω–∏–∫–∞</button>
                    <button class="tab-btn px-3 py-1.5 text-xs font-semibold border-b-2 border-transparent text-gray-500" data-category="books" onclick="setCategory('books')">üìö –ö–Ω–∏–≥–∏</button>
                </div>
            </div>
            
            <div class="mx-4 mt-3 bg-gradient-to-r from-amber-50 to-yellow-50 border-l-4 border-amber-400 rounded-xl p-2 text-xs text-amber-800">
                üí° <strong>–ó–∞–º–µ—Ç–∏–ª ‚Üí –û—Ç–º–µ—Ç–∏–ª ‚Üí –ü–æ–º–æ–≥!</strong> –ü—É–±–ª–∏–∫—É–π—Ç–µ —Ç–æ, —á—Ç–æ —É–∂–µ –ª–µ–∂–∏—Ç —É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤.
            </div>
            
            <div id="feedItems" class="flex-1 overflow-y-auto p-4 space-y-4 pb-24">
                <div class="text-center py-12">
                    <div class="text-6xl mb-4">‚è≥</div>
                    <p class="text-gray-500">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
                </div>
            </div>
            
            <button onclick="showScreen('add')" class="floating-btn absolute bottom-20 right-4 w-14 h-14 bg-emerald-500 rounded-full flex items-center justify-center text-white text-2xl font-bold shadow-lg z-10">+</button>
            
            <div class="absolute bottom-0 left-0 right-0 bg-white border-t border-gray-100 px-6 py-3 flex justify-around">
                <button class="nav-item flex flex-col items-center text-gray-400" data-screen="map" onclick="showScreen('map')">
                    <span class="text-xl">üó∫Ô∏è</span>
                    <span class="text-xs">–ö–∞—Ä—Ç–∞</span>
                </button>
                <button class="nav-item flex flex-col items-center text-emerald-600" data-screen="feed" onclick="showScreen('feed')">
                    <span class="text-xl">üìã</span>
                    <span class="text-xs font-semibold">–õ–µ–Ω—Ç–∞</span>
                </button>
                <button class="nav-item flex flex-col items-center text-gray-400" data-screen="add" onclick="showScreen('add')">
                    <span class="text-xl">‚ûï</span>
                    <span class="text-xs">–î–æ–±–∞–≤–∏—Ç—å</span>
                </button>
                <button class="nav-item flex flex-col items-center text-gray-400" data-screen="profile" onclick="showScreen('profile')">
                    <span class="text-xl">üë§</span>
                    <span class="text-xs">–ü—Ä–æ—Ñ–∏–ª—å</span>
                </button>
            </div>
        </div>

        <!-- Screen: Add Item -->
        <div id="screen-add" class="screen h-screen bg-gray-50">
            <div class="bg-white px-4 py-3 border-b border-gray-100 flex items-center gap-3">
                <button onclick="showScreen('map')" class="text-2xl">‚Üê</button>
                <h1 class="text-lg font-bold text-gray-800">–î–æ–±–∞–≤–∏—Ç—å –Ω–∞—Ö–æ–¥–∫—É</h1>
            </div>
            
            <div class="flex-1 overflow-y-auto p-4 space-y-4 pb-8">
                <div class="bg-gradient-to-r from-amber-50 to-yellow-50 border-l-4 border-amber-400 rounded-xl p-3">
                    <p class="text-sm text-amber-800">
                        ‚ö†Ô∏è <strong>–í–∞–∂–Ω–æ:</strong> –ü—É–±–ª–∏–∫—É–π—Ç–µ —Ç–æ–ª—å–∫–æ —Ç–æ, —á—Ç–æ <strong>—É–∂–µ –ª–µ–∂–∏—Ç</strong> —É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤.
                    </p>
                </div>
                
                <div id="uploadZone" class="border-2 border-dashed border-gray-300 rounded-2xl p-8 text-center bg-white cursor-pointer hover:border-emerald-500 hover:bg-emerald-50 transition">
                    <div class="text-5xl mb-2">üì∑</div>
                    <p class="font-semibold text-gray-700">–°—Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—Ä—É–π –Ω–∞—Ö–æ–¥–∫—É</p>
                    <p class="text-xs text-gray-500 mt-1">–ù–∞–∂–º–∏ –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ñ–æ—Ç–æ</p>
                </div>
                
                <div class="bg-white rounded-2xl p-4">
                    <label class="text-sm font-semibold text-gray-700 block mb-2">–ù–∞–∑–≤–∞–Ω–∏–µ *</label>
                    <input id="itemTitle" type="text" placeholder="–ß—Ç–æ —ç—Ç–æ? (–¥–∏–≤–∞–Ω, –∫–Ω–∏–≥–∏, —Å—Ç—É–ª—å—è...)" 
                           class="w-full p-3 bg-gray-50 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500">
                </div>
                
                <div class="bg-white rounded-2xl p-4">
                    <label class="text-sm font-semibold text-gray-700 block mb-2">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                    <textarea id="itemDescription" placeholder="–°–æ—Å—Ç–æ—è–Ω–∏–µ, —Ä–∞–∑–º–µ—Ä, –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏..." 
                              class="w-full h-20 p-3 bg-gray-50 rounded-xl text-sm resize-none focus:outline-none focus:ring-2 focus:ring-emerald-500"></textarea>
                </div>
                
                <div class="bg-white rounded-2xl p-4">
                    <label class="text-sm font-semibold text-gray-700 block mb-2">–ö–∞—Ç–µ–≥–æ—Ä–∏—è *</label>
                    <div class="flex flex-wrap gap-2">
                        <button class="category-chip px-3 py-1.5 bg-gray-100 rounded-full text-sm transition" data-category="furniture" onclick="selectCategory(this)">üõãÔ∏è –ú–µ–±–µ–ª—å</button>
                        <button class="category-chip px-3 py-1.5 bg-gray-100 rounded-full text-sm transition" data-category="construction" onclick="selectCategory(this)">üß± –°—Ç—Ä–æ–π–º–∞—Ç–µ—Ä–∏–∞–ª—ã</button>
                        <button class="category-chip px-3 py-1.5 bg-gray-100 rounded-full text-sm transition" data-category="electronics" onclick="selectCategory(this)">üì∫ –¢–µ—Ö–Ω–∏–∫–∞</button>
                        <button class="category-chip px-3 py-1.5 bg-gray-100 rounded-full text-sm transition" data-category="clothing" onclick="selectCategory(this)">üëï –û–¥–µ–∂–¥–∞</button>
                        <button class="category-chip px-3 py-1.5 bg-gray-100 rounded-full text-sm transition" data-category="books" onclick="selectCategory(this)">üìö –ö–Ω–∏–≥–∏</button>
                        <button class="category-chip px-3 py-1.5 bg-gray-100 rounded-full text-sm transition" data-category="plants" onclick="selectCategory(this)">ü™¥ –†–∞—Å—Ç–µ–Ω–∏—è</button>
                        <button class="category-chip px-3 py-1.5 bg-gray-100 rounded-full text-sm transition" data-category="other" onclick="selectCategory(this)">üì¶ –î—Ä—É–≥–æ–µ</button>
                    </div>
                </div>
                
                <div class="bg-white rounded-2xl p-4">
                    <label class="text-sm font-semibold text-gray-700 block mb-2">–ì–¥–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è?</label>
                    <button id="getLocationBtn" onclick="getCurrentLocation()" class="w-full flex items-center gap-3 p-3 bg-emerald-50 rounded-xl text-emerald-700 font-semibold hover:bg-emerald-100 transition">
                        <span class="text-xl">üìç</span>
                        <span>–û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏</span>
                        <span id="locationStatus" class="ml-auto"></span>
                    </button>
                    <input id="locationDetails" type="text" placeholder="–£—Ç–æ—á–Ω–∏: —É –ø–æ–¥—ä–µ–∑–¥–∞ 3, –∑–∞ –¥–æ–º–æ–º..." 
                           class="w-full mt-2 p-3 bg-gray-50 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500">
                    <p id="locationInfo" class="text-xs text-gray-500 mt-2"></p>
                </div>
                
                <div class="bg-white rounded-2xl p-4">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="font-semibold text-gray-700">üí¨ –†–∞–∑—Ä–µ—à–∏—Ç—å —á–∞—Ç</p>
                            <p class="text-xs text-gray-500">–õ—é–¥–∏ —Å–º–æ–≥—É—Ç –Ω–∞–ø–∏—Å–∞—Ç—å —Ç–µ–±–µ</p>
                        </div>
                        <div id="chatToggle" class="w-12 h-6 bg-emerald-500 rounded-full relative cursor-pointer" onclick="toggleChat()">
                            <div class="absolute right-1 top-1 w-4 h-4 bg-white rounded-full shadow transition-all"></div>
                        </div>
                    </div>
                </div>
                
                <div class="bg-blue-50 rounded-xl p-3 text-sm text-blue-800">
                    ‚è∞ –û–±—ä—è–≤–ª–µ–Ω–∏–µ –±—É–¥–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ <strong>6 —á–∞—Å–æ–≤</strong>. –¢—ã —Å–º–æ–∂–µ—à—å –ø—Ä–æ–¥–ª–∏—Ç—å –µ–≥–æ.
                </div>
                
                <button onclick="publishItem()" class="w-full bg-emerald-500 text-white font-bold py-4 rounded-2xl text-lg hover:bg-emerald-600 transition shadow-lg">
                    –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å üöÄ
                </button>
            </div>
        </div>

        <!-- Screen: Profile -->
        <div id="screen-profile" class="screen h-screen bg-gray-50">
            <div class="bg-gradient-to-br from-emerald-500 to-teal-600 px-4 py-6 text-white">
                <button onclick="showScreen('map')" class="text-2xl mb-4">‚Üê</button>
                
                <div class="flex items-center gap-4">
                    <div id="userAvatar" class="w-20 h-20 rounded-full bg-white/20 flex items-center justify-center text-3xl font-bold backdrop-blur">?</div>
                    <div>
                        <h1 id="userName" class="text-xl font-bold">–ó–∞–≥—Ä—É–∑–∫–∞...</h1>
                        <p id="userUsername" class="text-emerald-100 text-sm">@username</p>
                    </div>
                </div>
                
                <div class="mt-4 flex items-center gap-3">
                    <div class="bg-gradient-to-r from-yellow-400 to-amber-500 px-4 py-2 rounded-full flex items-center gap-2 shadow-lg">
                        <span class="text-xl">‚≠ê</span>
                        <span id="userKarma" class="font-bold text-lg">0</span>
                        <span class="text-sm opacity-80">–∫–∞—Ä–º—ã</span>
                    </div>
                </div>
            </div>
            
            <div class="flex-1 overflow-y-auto p-4 space-y-4 pb-8">
                <div id="userStats" class="grid grid-cols-3 gap-3">
                    <div class="bg-white rounded-2xl p-4 text-center shadow-sm">
                        <div id="statPublished" class="text-2xl font-bold text-emerald-600">0</div>
                        <div class="text-xs text-gray-500">–í—ã–ª–æ–∂–µ–Ω–æ</div>
                    </div>
                    <div class="bg-white rounded-2xl p-4 text-center shadow-sm">
                        <div id="statTaken" class="text-2xl font-bold text-purple-600">0</div>
                        <div class="text-xs text-gray-500">–ó–∞–±—Ä–∞–ª–∏</div>
                    </div>
                    <div class="bg-white rounded-2xl p-4 text-center shadow-sm">
                        <div id="statSaved" class="text-2xl font-bold text-orange-600">~0–∫–≥</div>
                        <div class="text-xs text-gray-500">–°–ø–∞—Å–µ–Ω–æ</div>
                    </div>
                </div>
                
                <div id="adminPanelBtn" class="hidden">
                    <button onclick="openAdminPanel()" class="w-full flex items-center justify-center gap-3 p-4 bg-purple-500 text-white rounded-2xl font-semibold shadow-lg hover:bg-purple-600 transition">
                        <span class="text-xl">‚öôÔ∏è</span>
                        <span>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</span>
                    </button>
                </div>
                
                <div class="bg-white rounded-2xl p-4 shadow-sm">
                    <h3 class="font-bold text-gray-800 mb-3">üì¶ –ú–æ–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏—è</h3>
                    <div id="myItemsList" class="space-y-2">
                        <p class="text-gray-500 text-center py-4">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Screen: Detail -->
        <div id="screen-detail" class="screen h-screen bg-gray-50">
            <div id="detailContent" class="flex-1 overflow-y-auto"></div>
        </div>

    </div>

    <!-- Modals -->
    <div id="successModal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50">
        <div class="bg-white rounded-3xl p-6 m-4 text-center max-w-sm">
            <div class="text-6xl mb-4" id="successEmoji">üéâ</div>
            <h2 class="text-xl font-bold text-gray-800 mb-2" id="successTitle">–£—Å–ø–µ—à–Ω–æ!</h2>
            <p class="text-gray-600 mb-4" id="successText">–û–ø–µ—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞</p>
            <button onclick="hideModal()" class="w-full bg-emerald-500 text-white font-bold py-3 rounded-xl">–û—Ç–ª–∏—á–Ω–æ!</button>
        </div>
    </div>

    <div id="creatorSetupModal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-2xl p-6 max-w-md w-full">
            <div class="text-center mb-6">
                <div class="text-5xl mb-4">üëë</div>
                <h2 class="text-xl font-bold text-gray-800">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</h2>
                <p class="text-gray-600 mt-2">–í—ã –ø–µ—Ä–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å. –í–≤–µ–¥–∏—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã.</p>
            </div>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">–¢–æ–∫–µ–Ω –±–æ—Ç–∞ –æ—Ç @BotFather</label>
                    <input type="text" id="botTokenInput" placeholder="123456789:ABCdefGHI..."
                           class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500">
                </div>
                
                <div class="text-sm text-gray-500">
                    <p>üìù –ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω:</p>
                    <ol class="list-decimal list-inside mt-1 space-y-1">
                        <li>–û—Ç–∫—Ä–æ–π—Ç–µ @BotFather –≤ Telegram</li>
                        <li>–û—Ç–ø—Ä–∞–≤—å—Ç–µ /mybots</li>
                        <li>–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à–µ–≥–æ –±–æ—Ç–∞</li>
                        <li>–ù–∞–∂–º–∏—Ç–µ "API Token"</li>
                    </ol>
                </div>
            </div>
            
            <button onclick="setupCreator()" class="w-full mt-6 py-3 bg-gradient-to-r from-emerald-500 to-teal-600 text-white font-semibold rounded-xl hover:shadow-lg transition">
                ‚úÖ –°—Ç–∞—Ç—å —Å–æ–∑–¥–∞—Ç–µ–ª–µ–º
            </button>
            
            <button onclick="hideCreatorSetupModal()" class="w-full mt-2 py-2 text-gray-500 text-sm">
                –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å
            </button>
        </div>
    </div>

    <div id="mapProviderModal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50">
        <div class="bg-white rounded-3xl p-6 m-4 w-full max-w-sm">
            <h2 class="text-xl font-bold text-gray-800 mb-4 text-center">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ä—Ç—É</h2>
            <div class="space-y-3">
                <button onclick="openMapProvider('yandex')" class="w-full p-4 border-2 border-gray-200 rounded-xl text-left hover:border-emerald-500 hover:bg-emerald-50 transition">
                    <div class="flex items-center gap-3">
                        <span class="text-3xl">üó∫Ô∏è</span>
                        <div>
                            <p class="font-semibold text-gray-800">–Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç—ã</p>
                            <p class="text-xs text-gray-500">–û—Ç–∫—Ä—ã—Ç—å –≤ –Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç–∞—Ö</p>
                        </div>
                    </div>
                </button>
                <button onclick="openMapProvider('2gis')" class="w-full p-4 border-2 border-gray-200 rounded-xl text-left hover:border-emerald-500 hover:bg-emerald-50 transition">
                    <div class="flex items-center gap-3">
                        <span class="text-3xl">üó∫Ô∏è</span>
                        <div>
                            <p class="font-semibold text-gray-800">2–ì–ò–°</p>
                            <p class="text-xs text-gray-500">–û—Ç–∫—Ä—ã—Ç—å –≤ 2–ì–ò–°</p>
                        </div>
                    </div>
                </button>
                <button onclick="openMapProvider('google')" class="w-full p-4 border-2 border-gray-200 rounded-xl text-left hover:border-emerald-500 hover:bg-emerald-50 transition">
                    <div class="flex items-center gap-3">
                        <span class="text-3xl">üó∫Ô∏è</span>
                        <div>
                            <p class="font-semibold text-gray-800">Google Maps</p>
                            <p class="text-xs text-gray-500">–û—Ç–∫—Ä—ã—Ç—å –≤ Google Maps</p>
                        </div>
                    </div>
                </button>
            </div>
            <button onclick="document.getElementById('mapProviderModal').classList.add('hidden')" class="w-full mt-4 py-3 text-gray-500 font-semibold">–û—Ç–º–µ–Ω–∞</button>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/config.js"></script>
    <script src="js/api.js"></script>
    
    <script>
    // ==========================================
    // –ì–õ–ê–í–ù–´–ô –°–ö–†–ò–ü–¢ –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø
    // ==========================================
    
    (function() {
        'use strict';
        
        // –ì–ª–æ–±–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
        window.App = {
            currentScreen: 'map',
            previousScreen: 'map',
            selectedCategory: 'all',
            selectedRadius: 2,
            searchQuery: '',
            currentLocation: null,
            uploadedPhoto: null,
            chatEnabled: true
        };
        
        console.log('üì¶ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...');
        
        // ==========================================
        // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø
        // ==========================================
        
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('üìÑ DOM –∑–∞–≥—Ä—É–∂–µ–Ω');
            
            // –ñ–¥—ë–º –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∫—Ä–∏–ø—Ç–æ–≤
            await waitForScripts();
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
            await initApp();
        });
        
        async function waitForScripts() {
            let attempts = 0;
            while (!window.CONFIG && attempts < 50) {
                await sleep(100);
                attempts++;
            }
            
            if (!window.CONFIG) {
                throw new Error('CONFIG –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
            }
            
            console.log('‚úÖ –°–∫—Ä–∏–ø—Ç—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã');
        }
        
        async function initApp() {
            try {
                console.log('üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è...');
                
                // 1. Telegram WebApp
                const tg = window.Telegram?.WebApp;
                if (tg) {
                    tg.ready();
                    tg.expand();
                    console.log('‚úÖ Telegram WebApp –≥–æ—Ç–æ–≤');
                }
                
                // 2. –ü–æ–ª—É—á–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                let user = tg?.initDataUnsafe?.user;
                
                if (!user) {
                    console.log('‚ö†Ô∏è –ú–æ–∫-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏');
                    user = { id: 123456789, first_name: '–¢–µ—Å—Ç', username: 'test_user' };
                    showDevBanner();
                }
                
                window.currentUser = user;
                console.log('üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:', user.id, user.first_name);
                
                // 3. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º API
                if (window.API) {
                    await API.init(user);
                    console.log('‚úÖ API –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
                }
                
                // 4. –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                await loadUserData();
                
                // 5. –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∞–≤–∞
                await checkPermissions();
                
                // 6. –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
                hideAuthScreen();
                showMainApp();
                
                // 7. –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–π —ç–∫—Ä–∞–Ω
                showScreen('feed');
                
                // 8. –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
                await loadFeedData();
                
                console.log('üéâ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ!');
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:', error);
                showError(error.message);
            }
        }
        
        async function loadUserData() {
            try {
                if (window.API) {
                    const userData = await API.getCurrentUser();
                    window.currentUserData = userData;
                    updateProfileUI(userData);
                }
            } catch (e) {
                console.warn('‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ:', e.message);
                window.currentUserData = {
                    telegram_id: window.currentUser.id,
                    name: window.currentUser.first_name,
                    karma: 0
                };
            }
        }
        
        async function checkPermissions() {
            if (!window.API) return;
            
            try {
                const rights = await API.request('/api/auth/check-admin').catch(() => ({}));
                const isAdmin = rights.isAdmin || rights.isCreator;
                
                if (isAdmin) {
                    document.getElementById('adminPanelBtn')?.classList.remove('hidden');
                    document.getElementById('adminBtnMap')?.classList.remove('hidden');
                }
                
                const creator = await API.request('/api/auth/check-creator').catch(() => ({ hasCreator: true }));
                if (!creator.hasCreator) {
                    showCreatorSetupModal();
                }
                
                window.userPermissions = rights;
            } catch (e) {
                console.warn('‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤:', e.message);
            }
        }
        
        // ==========================================
        // UI –§–£–ù–ö–¶–ò–ò
        // ==========================================
        
        window.showScreen = function(name) {
            console.log('üì± –≠–∫—Ä–∞–Ω:', name);
            
            if (App.currentScreen !== 'detail' && name === 'detail') {
                App.previousScreen = App.currentScreen;
            }
            
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —ç–∫—Ä–∞–Ω—ã
            document.querySelectorAll('.screen').forEach(el => {
                el.classList.remove('active');
            });
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—ã–π
            const screen = document.getElementById('screen-' + name);
            if (screen) {
                screen.classList.add('active');
                App.currentScreen = name;
            }
            
            // –ù–∞–≤–∏–≥–∞—Ü–∏—è
            document.querySelectorAll('.nav-item').forEach(el => {
                const isActive = el.dataset.screen === name;
                el.classList.toggle('text-emerald-600', isActive);
                el.classList.toggle('text-gray-400', !isActive);
            });
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —ç–∫—Ä–∞–Ω–∞
            if (name === 'feed') loadFeedData();
            if (name === 'map') loadMapData();
            if (name === 'profile') loadProfileData();
            if (name === 'add') initAddScreen();
        };
        
        function hideAuthScreen() {
            const el = document.getElementById('authScreen');
            if (el) el.style.display = 'none';
        }
        
        function showMainApp() {
            const el = document.getElementById('mainApp');
            if (el) {
                el.style.display = 'block';
                el.classList.remove('hidden');
            }
        }
        
        function showDevBanner() {
            const banner = document.createElement('div');
            banner.innerHTML = `
                <div style="position:fixed;top:0;left:0;right:0;background:linear-gradient(90deg,#f59e0b,#d97706);color:white;padding:8px;text-align:center;font-size:13px;z-index:10000;">
                    ‚ö†Ô∏è –†–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
                    <button onclick="this.parentElement.remove()" style="margin-left:12px;background:rgba(0,0,0,0.2);border:none;color:white;padding:2px 8px;border-radius:4px;cursor:pointer;">‚úï</button>
                </div>
            `;
            document.body.prepend(banner);
        }
        
        function showError(message) {
            const el = document.getElementById('authError');
            if (el) {
                el.innerHTML = `<p class="font-semibold">‚õî –û—à–∏–±–∫–∞</p><p class="text-sm mt-1">${message}</p>`;
                el.classList.remove('hidden');
            }
            document.getElementById('authStatus')?.classList.add('hidden');
        }
        
        function updateProfileUI(user) {
            if (!user) return;
            
            const avatar = document.getElementById('userAvatar');
            const name = document.getElementById('userName');
            const username = document.getElementById('userUsername');
            const karma = document.getElementById('userKarma');
            
            if (avatar) avatar.textContent = (user.name || '?')[0].toUpperCase();
            if (name) name.textContent = user.name || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
            if (username) username.textContent = user.username ? `@${user.username}` : '';
            if (karma) karma.textContent = user.karma || 0;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è
            document.querySelectorAll('[id^="profileBtn"]').forEach(btn => {
                btn.textContent = (user.name || '?')[0].toUpperCase();
            });
        }
        
        // ==========================================
        // –î–ê–ù–ù–´–ï
        // ==========================================
        
        async function loadFeedData() {
            const container = document.getElementById('feedItems');
            if (!container) return;
            
            try {
                const items = window.API ? await API.getItems({}) : getMockItems();
                
                if (items.length === 0) {
                    container.innerHTML = `
                        <div class="text-center py-12">
                            <div class="text-6xl mb-4">üì≠</div>
                            <p class="text-gray-500">–ü–æ–∫–∞ –Ω–µ—Ç –Ω–∞—Ö–æ–¥–æ–∫</p>
                            <p class="text-sm text-gray-400 mt-1">–ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º!</p>
                        </div>
                    `;
                    return;
                }
                
                container.innerHTML = items.map(item => renderItemCard(item)).join('');
                
            } catch (e) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', e);
                container.innerHTML = `<p class="text-center text-red-500 py-4">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</p>`;
            }
        }
        
        async function loadMapData() {
            const container = document.getElementById('mapMarkers');
            const countEl = document.getElementById('mapItemsCount');
            if (!container) return;
            
            try {
                const items = window.API ? await API.getItems({ status: 'active' }) : getMockItems();
                
                if (countEl) {
                    countEl.textContent = `${items.length} –Ω–∞—Ö–æ–¥–æ–∫ –≤ —Ä–∞–¥–∏—É—Å–µ ${App.selectedRadius} –∫–º`;
                }
                
                // –†–µ–Ω–¥–µ—Ä–∏–º –º–∞—Ä–∫–µ—Ä—ã (–¥–µ–º–æ-–ø–æ–∑–∏—Ü–∏–∏)
                const positions = [
                    { top: '25%', left: '33%' },
                    { top: '40%', left: '65%' },
                    { top: '60%', left: '25%' },
                    { top: '70%', left: '55%' }
                ];
                
                container.innerHTML = items.slice(0, 4).map((item, i) => {
                    const pos = positions[i] || positions[0];
                    return `
                        <div class="absolute cursor-pointer" style="top:${pos.top};left:${pos.left};transform:translate(-50%,-50%);" onclick="showItemDetail(${item.id})">
                            <div class="w-12 h-12 bg-emerald-500 rounded-full flex items-center justify-center text-2xl shadow-lg border-2 border-white">
                                ${item.emoji || 'üì¶'}
                            </div>
                        </div>
                    `;
                }).join('');
                
            } catch (e) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∫–∞—Ä—Ç—ã:', e);
            }
        }
        
        async function loadProfileData() {
            try {
                if (window.currentUserData) {
                    updateProfileUI(window.currentUserData);
                }
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –æ–±—ä—è–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                if (window.API && window.currentUser) {
                    const items = await API.getItems({ authorId: window.currentUser.id });
                    const container = document.getElementById('myItemsList');
                    
                    if (container) {
                        if (items.length === 0) {
                            container.innerHTML = '<p class="text-gray-500 text-center py-4">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –æ–±—ä—è–≤–ª–µ–Ω–∏–π</p>';
                        } else {
                            container.innerHTML = items.map(item => `
                                <div class="flex items-center gap-3 p-2 border border-gray-100 rounded-xl" onclick="showItemDetail(${item.id})">
                                    <span class="text-2xl">${item.emoji || 'üì¶'}</span>
                                    <div class="flex-1">
                                        <p class="text-sm font-semibold">${escapeHtml(item.title)}</p>
                                        <p class="text-xs text-${item.status === 'active' ? 'emerald' : 'gray'}-600">
                                            ${item.status === 'active' ? 'üü¢ –ê–∫—Ç–∏–≤–Ω–æ' : item.status === 'taken' ? '‚úÖ –ó–∞–±—Ä–∞–ª–∏' : '‚è∞ –ü—Ä–æ—Å—Ä–æ—á–µ–Ω–æ'}
                                        </p>
                                    </div>
                                </div>
                            `).join('');
                        }
                    }
                }
            } catch (e) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è:', e);
            }
        }
        
        function renderItemCard(item) {
            const statusBadge = item.status === 'taken' ? '<span class="absolute top-2 left-2 bg-gray-800/80 text-white px-2 py-1 rounded-full text-xs">‚úÖ –ó–∞–±—Ä–∞–ª–∏</span>' :
                               item.status === 'expired' ? '<span class="absolute top-2 left-2 bg-amber-500/80 text-white px-2 py-1 rounded-full text-xs">‚è∞ –ü—Ä–æ—Å—Ä–æ—á–µ–Ω–æ</span>' : '';
            
            return `
                <div class="bg-white rounded-2xl shadow-sm overflow-hidden ${item.status !== 'active' ? 'opacity-60' : ''}" onclick="showItemDetail(${item.id})">
                    <div class="relative h-40 bg-gradient-to-br from-gray-100 to-gray-200 flex items-center justify-center text-6xl">
                        ${item.emoji || 'üì¶'}
                        ${statusBadge}
                        <span class="absolute top-2 right-2 bg-white/90 text-gray-700 text-xs font-bold px-2 py-1 rounded-full">
                            üìç ${item.distance || '?'}–º
                        </span>
                    </div>
                    <div class="p-3">
                        <h3 class="font-bold text-gray-800">${escapeHtml(item.title)}</h3>
                        <p class="text-xs text-gray-500 mt-1">${escapeHtml(item.address || '–ê–¥—Ä–µ—Å –Ω–µ —É–∫–∞–∑–∞–Ω')}</p>
                        <div class="flex items-center justify-between mt-2">
                            <span class="text-xs text-gray-600">${escapeHtml(item.author_name || '–ê–Ω–æ–Ω–∏–º')} ‚Ä¢ ‚≠ê ${item.author_karma || 0}</span>
                            ${item.status === 'active' ? `<span class="text-xs text-emerald-600 font-semibold">‚è± ${item.time_remaining || '?'}</span>` : ''}
                        </div>
                    </div>
                </div>
            `;
        }
        
        function getMockItems() {
            return [
                { id: 1, title: '–î–∏–≤–∞–Ω –≤ —Ö–æ—Ä–æ—à–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏', emoji: 'üõãÔ∏è', status: 'active', distance: 350, address: '—É–ª. –õ—å–≤–∞ –¢–æ–ª—Å—Ç–æ–≥–æ', author_name: '–ú–∏—Ö–∞–∏–ª', author_karma: 48, time_remaining: '5—á' },
                { id: 2, title: '–ö–æ—Ä–æ–±–∫–∞ –∫–Ω–∏–≥', emoji: 'üìö', status: 'active', distance: 1200, address: '–ö–æ–º—Å–æ–º–æ–ª—å—Å–∫–∏–π –ø—Ä-—Ç', author_name: '–ï–ª–µ–Ω–∞', author_karma: 156, time_remaining: '4—á' },
                { id: 3, title: '–°—Ç–∞—Ä—ã–π —Ç–µ–ª–µ–≤–∏–∑–æ—Ä', emoji: 'üì∫', status: 'taken', distance: 800, address: '—É–ª. –£—Å–∞—á—ë–≤–∞', author_name: '–ê–Ω–¥—Ä–µ–π', author_karma: 89 }
            ];
        }
        
        // ==========================================
        // –î–ï–ô–°–¢–í–ò–Ø
        // ==========================================
        
        window.showItemDetail = async function(id) {
            console.log('üìÑ –î–µ—Ç–∞–ª–∏:', id);
            
            const container = document.getElementById('detailContent');
            if (!container) return;
            
            try {
                const item = window.API ? await API.getItem(id) : getMockItems().find(i => i.id === id);
                
                if (!item) {
                    container.innerHTML = '<p class="text-center py-8 text-red-500">–û–±—ä—è–≤–ª–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</p>';
                    showScreen('detail');
                    return;
                }
                
                container.innerHTML = `
                    <div class="relative h-56 bg-gradient-to-br from-gray-100 to-gray-200 flex items-center justify-center text-8xl">
                        ${item.emoji || 'üì¶'}
                        <button onclick="showScreen('${App.previousScreen || 'feed'}')" class="absolute top-4 left-4 w-10 h-10 bg-white/90 rounded-full flex items-center justify-center text-xl shadow">‚Üê</button>
                    </div>
                    <div class="p-4 space-y-4">
                        <div>
                            <h1 class="text-xl font-bold text-gray-800">${escapeHtml(item.title)}</h1>
                            <p class="text-sm text-gray-500 mt-1">${escapeHtml(item.category || '–ü—Ä–æ—á–µ–µ')}</p>
                        </div>
                        
                        <div class="flex items-center gap-3 p-3 bg-gray-50 rounded-xl">
                            <div class="w-12 h-12 rounded-full bg-emerald-100 flex items-center justify-center text-lg font-bold">
                                ${(item.author_name || '?')[0]}
                            </div>
                            <div>
                                <p class="font-semibold">${escapeHtml(item.author_name || '–ê–Ω–æ–Ω–∏–º')}</p>
                                <p class="text-xs text-gray-500">‚≠ê ${item.author_karma || 0} –∫–∞—Ä–º—ã</p>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-xl p-4 border border-gray-100">
                            <h3 class="font-semibold text-gray-800 mb-2">üìù –û–ø–∏—Å–∞–Ω–∏–µ</h3>
                            <p class="text-sm text-gray-600">${escapeHtml(item.description || '–û–ø–∏—Å–∞–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç')}</p>
                        </div>
                        
                        <div class="bg-white rounded-xl p-4 border border-gray-100">
                            <h3 class="font-semibold text-gray-800 mb-2">üìç –ì–¥–µ –∑–∞–±—Ä–∞—Ç—å</h3>
                            <p class="text-sm text-gray-600">${escapeHtml(item.address || '–ê–¥—Ä–µ—Å –Ω–µ —É–∫–∞–∑–∞–Ω')}</p>
                            <button onclick="openInMaps(${item.lat || 55.75}, ${item.lng || 37.62})" class="mt-2 w-full p-3 bg-blue-50 text-blue-700 rounded-xl font-semibold">
                                üó∫Ô∏è –û—Ç–∫—Ä—ã—Ç—å –Ω–∞ –∫–∞—Ä—Ç–µ
                            </button>
                        </div>
                        
                        ${item.status === 'active' ? `
                            <button onclick="takeItem(${item.id})" class="w-full bg-emerald-500 text-white font-bold py-4 rounded-2xl text-lg shadow-lg">
                                –ó–∞–±–µ—Ä—É! üôã‚Äç‚ôÇÔ∏è
                            </button>
                        ` : ''}
                    </div>
                `;
                
                showScreen('detail');
                
            } catch (e) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', e);
            }
        };
        
        window.takeItem = async function(id) {
            try {
                if (window.API) {
                    await API.markAsTaken(id);
                }
                showSuccessModal('üôå', '–û—Ç–ª–∏—á–Ω–æ!', '–ê–≤—Ç–æ—Ä –ø–æ–ª—É—á–∏—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ');
            } catch (e) {
                alert('–û—à–∏–±–∫–∞: ' + e.message);
            }
        };
        
        window.publishItem = async function() {
            const title = document.getElementById('itemTitle')?.value?.trim();
            const description = document.getElementById('itemDescription')?.value?.trim();
            const selectedCat = document.querySelector('.category-chip.selected');
            
            if (!title) {
                alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ');
                return;
            }
            
            if (!selectedCat) {
                alert('–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é');
                return;
            }
            
            try {
                if (window.API) {
                    await API.createItem({
                        title,
                        description,
                        category: selectedCat.dataset.category,
                        lat: App.currentLocation?.lat,
                        lng: App.currentLocation?.lng,
                        address: document.getElementById('locationDetails')?.value || '',
                        chat_enabled: App.chatEnabled
                    });
                }
                
                showSuccessModal('üéâ', '–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ!', '+10 –∫–∞—Ä–º—ã');
                
                // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
                document.getElementById('itemTitle').value = '';
                document.getElementById('itemDescription').value = '';
                document.querySelectorAll('.category-chip').forEach(c => c.classList.remove('selected', 'bg-emerald-500', 'text-white'));
                
            } catch (e) {
                alert('–û—à–∏–±–∫–∞: ' + e.message);
            }
        };
        
        window.selectCategory = function(el) {
            document.querySelectorAll('.category-chip').forEach(c => {
                c.classList.remove('selected', 'bg-emerald-500', 'text-white');
                c.classList.add('bg-gray-100');
            });
            el.classList.add('selected', 'bg-emerald-500', 'text-white');
            el.classList.remove('bg-gray-100');
        };
        
        window.setCategory = function(cat) {
            App.selectedCategory = cat;
            document.querySelectorAll('.tab-btn').forEach(btn => {
                const isActive = btn.dataset.category === cat;
                btn.classList.toggle('border-emerald-500', isActive);
                btn.classList.toggle('text-emerald-600', isActive);
                btn.classList.toggle('border-transparent', !isActive);
                btn.classList.toggle('text-gray-500', !isActive);
            });
            loadFeedData();
        };
        
        window.setRadius = function(km) {
            App.selectedRadius = km;
            document.querySelectorAll('.radius-btn').forEach(btn => {
                const isActive = parseFloat(btn.dataset.radius) === km;
                btn.classList.toggle('bg-emerald-500', isActive);
                btn.classList.toggle('text-white', isActive);
                btn.classList.toggle('bg-gray-100', !isActive);
            });
            loadMapData();
        };
        
        window.handleSearch = function(query) {
            App.searchQuery = query;
            loadFeedData();
        };
        
        window.toggleChat = function() {
            App.chatEnabled = !App.chatEnabled;
            const toggle = document.getElementById('chatToggle');
            if (toggle) {
                toggle.classList.toggle('bg-emerald-500', App.chatEnabled);
                toggle.classList.toggle('bg-gray-300', !App.chatEnabled);
            }
        };
        
        window.getCurrentLocation = function() {
            const statusEl = document.getElementById('locationStatus');
            const infoEl = document.getElementById('locationInfo');
            
            if (statusEl) statusEl.textContent = '‚è≥';
            
            if ('geolocation' in navigator) {
                navigator.geolocation.getCurrentPosition(
                    (pos) => {
                        App.currentLocation = { lat: pos.coords.latitude, lng: pos.coords.longitude };
                        if (statusEl) statusEl.textContent = '‚úÖ';
                        if (infoEl) infoEl.textContent = `üìç ${pos.coords.latitude.toFixed(4)}, ${pos.coords.longitude.toFixed(4)}`;
                    },
                    (err) => {
                        if (statusEl) statusEl.textContent = '‚ùå';
                        if (infoEl) infoEl.textContent = '–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ';
                    }
                );
            } else {
                if (statusEl) statusEl.textContent = '‚ùå';
            }
        };
        
        function initAddScreen() {
            App.uploadedPhoto = null;
            App.chatEnabled = true;
            
            const toggle = document.getElementById('chatToggle');
            if (toggle) {
                toggle.classList.add('bg-emerald-500');
                toggle.classList.remove('bg-gray-300');
            }
            
            document.querySelectorAll('.category-chip').forEach(c => {
                c.classList.remove('selected', 'bg-emerald-500', 'text-white');
                c.classList.add('bg-gray-100');
            });
        }
        
        // ==========================================
        // –ú–û–î–ê–õ–ö–ò
        // ==========================================
        
        window.showSuccessModal = function(emoji, title, text) {
            document.getElementById('successEmoji').textContent = emoji;
            document.getElementById('successTitle').textContent = title;
            document.getElementById('successText').textContent = text;
            document.getElementById('successModal').classList.remove('hidden');
        };
        
        window.hideModal = function() {
            document.getElementById('successModal').classList.add('hidden');
            showScreen(App.previousScreen || 'feed');
        };
        
        window.showCreatorSetupModal = function() {
            document.getElementById('creatorSetupModal').classList.remove('hidden');
        };
        
        window.hideCreatorSetupModal = function() {
            document.getElementById('creatorSetupModal').classList.add('hidden');
        };
        
        window.setupCreator = async function() {
            const token = document.getElementById('botTokenInput')?.value?.trim();
            
            if (!token || !/^\d+:[A-Za-z0-9_-]+$/.test(token)) {
                alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ç–æ–∫–µ–Ω –±–æ—Ç–∞');
                return;
            }
            
            try {
                if (window.API) {
                    await API.request('/api/auth/setup-creator', {
                        method: 'POST',
                        body: JSON.stringify({ botToken: token })
                    });
                }
                
                hideCreatorSetupModal();
                alert('üéâ –í—ã —Å—Ç–∞–ª–∏ —Å–æ–∑–¥–∞—Ç–µ–ª–µ–º —Å–∏—Å—Ç–µ–º—ã!');
                document.getElementById('adminPanelBtn')?.classList.remove('hidden');
                
            } catch (e) {
                alert('–û—à–∏–±–∫–∞: ' + e.message);
            }
        };
        
        window.openAdminPanel = function() {
            window.location.href = 'admin.html';
        };
        
        window.openInMaps = function(lat, lng) {
            window.mapLat = lat;
            window.mapLng = lng;
            document.getElementById('mapProviderModal').classList.remove('hidden');
        };
        
        window.openMapProvider = function(provider) {
            document.getElementById('mapProviderModal').classList.add('hidden');
            
            const lat = window.mapLat || 55.75;
            const lng = window.mapLng || 37.62;
            
            const urls = {
                'yandex': `https://yandex.ru/maps/?pt=${lng},${lat}&z=16`,
                '2gis': `https://2gis.ru/search/${lat},${lng}`,
                'google': `https://www.google.com/maps/search/?api=1&query=${lat},${lng}`
            };
            
            window.open(urls[provider], '_blank');
        };
        
        // ==========================================
        // –£–¢–ò–õ–ò–¢–´
        // ==========================================
        
        function sleep(ms) {
            return new Promise(r => setTimeout(r, ms));
        }
        
        function escapeHtml(str) {
            if (!str) return '';
            return String(str)
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/"/g, '&quot;');
        }
        
        window.escapeHtml = escapeHtml;
        
    })();
    </script>

</body>
</html>