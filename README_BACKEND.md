# üóëÔ∏è –ü–æ–º–æ–µ—á–∫–∞ –∫–æ—Ä–º–∏—Ç - Backend

Backend –¥–ª—è Telegram Mini App "–ü–æ–º–æ–µ—á–∫–∞ –∫–æ—Ä–º–∏—Ç" —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö SQLite.

## üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
npm install
```

### 2. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å–æ–∑–¥–∞—Å—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ —Å–µ—Ä–≤–µ—Ä–∞.

–ò–ª–∏ –≤—Ä—É—á–Ω—É—é:

```bash
npm run init-db
```

### 3. –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞

**–†–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (—Å –∞–≤—Ç–æ–ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–æ–π):**
```bash
npm run dev
```

**–ü—Ä–æ–¥–∞–∫—à–Ω:**
```bash
npm start
```

–°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –Ω–∞ `http://localhost:3000`

## üì° API Endpoints

### Health Check
- `GET /health` - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

### Authentication
- `GET /api/auth/me` - –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `GET /api/auth/check-admin` - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–¥–º–∏–Ω–æ–º
- `POST /api/auth/setup-creator` - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–æ–∑–¥–∞—Ç–µ–ª—è (–ø–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫)

### Items (–û–±—ä—è–≤–ª–µ–Ω–∏—è)
- `GET /api/items` - –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è (—Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏)
- `GET /api/items/:id` - –ü–æ–ª—É—á–∏—Ç—å –æ–¥–Ω–æ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ
- `POST /api/items` - –°–æ–∑–¥–∞—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ
- `PATCH /api/items/:id` - –û–±–Ω–æ–≤–∏—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ
- `DELETE /api/items/:id` - –£–¥–∞–ª–∏—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ
- `POST /api/items/:id/taken` - –û—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ –∑–∞–±—Ä–∞–Ω–Ω–æ–µ
- `POST /api/items/:id/extend` - –ü—Ä–æ–¥–ª–∏—Ç—å —Å—Ä–æ–∫ –∂–∏–∑–Ω–∏

### Users (–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏)
- `GET /api/users/me` - –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `PATCH /api/users/me` - –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å
- `POST /api/users/karma` - –î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ä–º—É

### Reports (–ñ–∞–ª–æ–±—ã)
- `POST /api/reports` - –°–æ–∑–¥–∞—Ç—å –∂–∞–ª–æ–±—É
- `GET /api/reports` - –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∂–∞–ª–æ–±—ã (—Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω)
- `PATCH /api/reports/:id/resolve` - –†–µ—à–∏—Ç—å –∂–∞–ª–æ–±—É (—Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω)

### Analytics (–ê–Ω–∞–ª–∏—Ç–∏–∫–∞)
- `GET /api/analytics` - –ü–æ–ª—É—á–∏—Ç—å –∞–Ω–∞–ª–∏—Ç–∏–∫—É (—Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω)

### Admin (–ê–¥–º–∏–Ω–∫–∞)
- `GET /api/admin/settings` - –ü–æ–ª—É—á–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (—Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω)
- `POST /api/admin/settings` - –û–±–Ω–æ–≤–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (—Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω)
- `GET /api/admin/admins` - –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∞–¥–º–∏–Ω–æ–≤ (—Ç–æ–ª—å–∫–æ —Å–æ–∑–¥–∞—Ç–µ–ª—å)
- `POST /api/admin/admins` - –î–æ–±–∞–≤–∏—Ç—å –∞–¥–º–∏–Ω–∞ (—Ç–æ–ª—å–∫–æ —Å–æ–∑–¥–∞—Ç–µ–ª—å)
- `DELETE /api/admin/admins/:telegramId` - –£–¥–∞–ª–∏—Ç—å –∞–¥–º–∏–Ω–∞ (—Ç–æ–ª—å–∫–æ —Å–æ–∑–¥–∞—Ç–µ–ª—å)

## üîê –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

–í—Å–µ –∑–∞–ø—Ä–æ—Å—ã (–∫—Ä–æ–º–µ –ø—É–±–ª–∏—á–Ω—ã—Ö) —Ç—Ä–µ–±—É—é—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫:
```
X-Telegram-ID: <telegram_user_id>
```

–ò–ª–∏ –ø–µ—Ä–µ–¥–∞—Ç—å –≤ —Ç–µ–ª–µ –∑–∞–ø—Ä–æ—Å–∞:
```json
{
  "telegram_id": 123456789
}
```

## üëë –°–∏—Å—Ç–µ–º–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤

### –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ (–Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–æ–∑–¥–∞—Ç–µ–ª—è)

1. –û—Ç–∫—Ä–æ–π—Ç–µ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –≤ Telegram
2. –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –ø–æ—è–≤–∏—Ç—Å—è –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–æ–∑–¥–∞—Ç–µ–ª—è
3. –ù–∞–∂–º–∏—Ç–µ "–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∏ –≤–æ–π—Ç–∏"
4. –í–∞—à Telegram ID –±—É–¥–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω –∫–∞–∫ —Å–æ–∑–¥–∞—Ç–µ–ª—å

### –°–æ–∑–¥–∞—Ç–µ–ª—å vs –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä

- **–°–æ–∑–¥–∞—Ç–µ–ª—å** - –ø–µ—Ä–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –∫–æ—Ç–æ—Ä—ã–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª —Å–∏—Å—Ç–µ–º—É. –¢–æ–ª—å–∫–æ –æ–Ω –º–æ–∂–µ—Ç:
  - –î–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã—Ö –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
  - –£–¥–∞–ª—è—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
  - –í–∏–¥–µ—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤

- **–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–π —Å–æ–∑–¥–∞—Ç–µ–ª–µ–º. –ú–æ–∂–µ—Ç:
  - –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –∏ –º–æ–¥–µ—Ä–µ—Ä–æ–≤–∞—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏—è
  - –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –∂–∞–ª–æ–±—ã
  - –ò–∑–º–µ–Ω—è—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã
  - –ù–û –Ω–µ –º–æ–∂–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å –¥—Ä—É–≥–∏–º–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º–∏

## üíæ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è SQLite. –§–∞–π–ª –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö: `data/pomoechka.db`

### –¢–∞–±–ª–∏—Ü—ã:

- `users` - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- `items` - –û–±—ä—è–≤–ª–µ–Ω–∏—è
- `reports` - –ñ–∞–ª–æ–±—ã
- `admins` - –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã
- `settings` - –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏

–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü–µ `settings`:

- `item_lifetime_hours` - –í—Ä–µ–º—è –∂–∏–∑–Ω–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 6 —á–∞—Å–æ–≤)
- `karma_publish` - –ö–∞—Ä–º–∞ –∑–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏—é (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 10)
- `karma_taken` - –ö–∞—Ä–º–∞ –µ—Å–ª–∏ –∑–∞–±—Ä–∞–ª–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 25)
- `karma_extend` - –ö–∞—Ä–º–∞ –∑–∞ –ø—Ä–æ–¥–ª–µ–Ω–∏–µ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 2)
- `karma_thanks` - –ö–∞—Ä–º–∞ –∑–∞ –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 5)
- `auto_hide_reports` - –ê–≤—Ç–æ—Å–∫—Ä—ã—Ç–∏–µ –ø—Ä–∏ N –∂–∞–ª–æ–±–∞—Ö (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 3)
- `require_photo` - –¢—Ä–µ–±–æ–≤–∞—Ç—å —Ñ–æ—Ç–æ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: false)
- `pre_moderation` - –ü—Ä–µ–º–æ–¥–µ—Ä–∞—Ü–∏—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: false)

## üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞

–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –±—ç–∫–µ–Ω–¥–∞ –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å `js/config.js`:

```javascript
API_URL: 'http://localhost:3000' // –∏–ª–∏ URL –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
```

–ò –æ–±–Ω–æ–≤–∏—Ç—å `js/api.js` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ä–µ–∞–ª—å–Ω—ã–º API –≤–º–µ—Å—Ç–æ localStorage.

## üìù –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤

### –°–æ–∑–¥–∞—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ

```bash
curl -X POST http://localhost:3000/api/items \
  -H "Content-Type: application/json" \
  -H "X-Telegram-ID: 123456789" \
  -d '{
    "title": "–î–∏–≤–∞–Ω –≤ —Ö–æ—Ä–æ—à–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏",
    "description": "–†–∞—Å–∫–ª–∞–¥–Ω–æ–π –¥–∏–≤–∞–Ω",
    "category": "furniture",
    "emoji": "üõãÔ∏è",
    "location": {
      "address": "—É–ª. –õ—å–≤–∞ –¢–æ–ª—Å—Ç–æ–≥–æ, 16",
      "details": "—É –ø–æ–¥—ä–µ–∑–¥–∞ 3",
      "lat": 55.7558,
      "lng": 37.6173
    },
    "chatEnabled": true
  }'
```

### –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è

```bash
curl http://localhost:3000/api/items?status=active
```

### –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–æ–∑–¥–∞—Ç–µ–ª—è

```bash
curl -X POST http://localhost:3000/api/auth/setup-creator \
  -H "Content-Type: application/json" \
  -H "X-Telegram-ID: 123456789" \
  -d '{
    "name": "–ò–≤–∞–Ω",
    "username": "@ivan"
  }'
```

## üöÄ –î–µ–ø–ª–æ–π

### Heroku

1. –°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ Heroku
2. –î–æ–±–∞–≤—å—Ç–µ buildpack –¥–ª—è Node.js
3. –ó–∞–ø—É—à–∏—Ç–µ –∫–æ–¥
4. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö SQLite –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

### VPS

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Node.js
2. –°–∫–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏: `npm install`
4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ: `npm start`
5. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ PM2 –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–æ–º:

```bash
npm install -g pm2
pm2 start server.js
pm2 save
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

‚ö†Ô∏è **–í–∞–∂–Ω–æ:** –í –ø—Ä–æ–¥–∞–∫—à–Ω–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ:

1. –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ–¥–ø–∏—Å–∏ Telegram WebApp initData
2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å HTTPS
3. –î–æ–±–∞–≤–∏—Ç—å rate limiting
4. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å CORS –ø—Ä–∞–≤–∏–ª—å–Ω–æ
5. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è —Å–µ–∫—Ä–µ—Ç–æ–≤

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT

